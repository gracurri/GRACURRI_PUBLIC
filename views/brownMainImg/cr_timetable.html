<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- <script src="http://code.jquery.com/jquery-latest.min.js"></script> -->
    <script src="./cr_timetable.js"></script>
    
</head>
<body>
    <div style="margin-right: 150px">  
      <form method="GET" id="sever">
      <table class="time" width=500px style="color: #121212; border-collapse: collapse; border-radius: 10px; table-layout: fixed; height:500px;">
        <thead>
          <tr>
              <th></th>
              <th>월</th>
              <th>화</th>
              <th>수</th>
              <th>목</th>
              <th>금</th>
          </tr>
          <tr>
              <th>
                  <div class="hours">
                      <div style="height: 60px; top: 480px; line-height: 60px;">1</div>
                      <div style="height: 60px; top: 540px; line-height: 60px;">2</div>
                      <div style="height: 60px; top: 630px; line-height: 60px;">3</div>
                      <div style="height: 60px; top: 720px; line-height: 60px;">4</div>
                      <div style="height: 60px; top: 810px; line-height: 60px;">5</div>
                      <div style="height: 60px; top: 900px; line-height: 60px;">6</div>
                      <div style="height: 60px; top: 1080px; line-height: 60px;">7</div>
                      <div style="height: 60px; top: 1170px; line-height: 60px;">8</div>
                      <div style="height: 60px; top: 1260px; line-height: 60px;">9</div>
                  </div>
              </th>
              <!-- <td>
                  <div id="Mon" class="cols" style="width: 70px;"></div>
              </td>
              <td> 
                  <div id="Tue" class="cols" style="width: 70px; height: 60px; top: 900px; background-color: rgb(88, 163, 88);">
                      형식언어및오토마타
                  </div>
              </td>
              <td>
                  <div id="Wed" class="cols" style="width: 70px;"></div>
              </td>
              <td> 
                  <div id="Thu" class="cols" style="width: 70px;"></div>
              </td>
              <td> 
                  <div id="Fri" class="cols" style="width: 70px;"></div>
              </td> -->
          </tr>

      </thead>  
      </table>
    </div>
    <style>
      table{
        border-collapse: separate;
        border-spacing: 0 1rem;
      }
      th{
          height: 5px;
          width: 10px;
      }
      td {
          width: 75px;
          height: 62.7px;
          font-size: 10pt;

          border: 4px solid rgb(254,228,171);
          border-collapse: collapse;
      }
    </style>
    <script>
      console.log('온로드')

      const make = document.getElementById('maketable');

      var getCookie = function(name) {
          var value = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
          return value? value[2] : null;
      };  

      let userCookieId = getCookie('userid');

      function timetonum(str){    // 시간 교시로 바꾸는 함수
          switch(str){
              case "09:00-10:15":
                  str = 1;
                  break;
              case "10:30-11:45":
                  str = 2;
                  break;
              case "12:00-13:15":
                  str = 3;
                  break;
              case "13:30-14:45":
                  str = 4;
                  break;
              case "15:00-16:15":
                  str = 5;
                  break;
              case "16:30-17:45":
                  str = 6;
                  break;
              case "18:00-19:15":
                  str = 7;
                  break;
              case "19:30-20:45":
                  str = 8;
                  break;
              case "21:00-22:15":
                  str = 9;
                  break;
          }
          return str;
      }

      function daytime(arr){
          var day1 = arr[0];
          if(arr[1] == "월" || arr[1] == "화" || arr[1] == "수" || arr[1] == "목" || arr[1] == "금"){     // 일주일에 2번인 수업
              timetonum(arr[2]);
              arr.push('two');
          }
          else{   // 바로 숫자 나오면 일주일에 한번인 수업, str = 시간
              timetonum(arr[1]);  // 교시로 바꿔주기
              if(arr[3] == arr[0]){     // 1교시 이상인 수업
                  arr[3] = arr[1] + 1;
                  arr.push('one2');
              }
              else{   // 1교시만 하는 수업
                  arr.push('one1');
              }
          }
          return arr;
      }




      const sem = async()=>{
          console.log(userCookieId)
          // GET
          fetch("http://localhost:3000/time_set?email=" + userCookieId)
          .then((res) => res.json())
          .then((res) => {
              console.log(res)
              if(res.code === 200){
                  location.assign('http://localhost:3000/cr_timetable');
                  const countSubject = Object.keys(res.result).length;
                  var talarr = res.timeandloc;

                  let Montd = document.createElement('td');
                  let MonDiv = document.createElement('div');
                  let MonP = document.createElement('p');

                  let Tuetd = document.createElement('td');
                  let TueDiv = document.createElement('div');
                  let TueP = document.createElement('p');

                  let Wedtd = document.createElement('td');
                  let WedDiv = document.createElement('div');
                  let WedP = document.createElement('p');

                  let Thutd = document.createElement('td');
                  let ThuDiv = document.createElement('div');
                  let ThuP = document.createElement('p');

                  let Fritd = document.createElement('td');
                  let FriDiv = document.createElement('div');
                  let FriP = document.createElement('p');

                  Montd = document.createElement('td');

                  for(i = 0; i < countSubject; i++){

                      var arr = talarr[i].split(' ');
                      arr = daytime(arr); 

                      // 일주일에 한번, 1교시
                      if(arr.indexof('one1') != -1){
                          if(arr.indexof('월') != -1){
                              MonDiv = document.createElement('div');
                              MonP = document.createElement('p');
                              
                              MonP.appendChild(res.result[i]);
                              MonDiv.style.position = absolute;
                              MonDiv.style.top = (110 + 60*(arr[1] - 1))+'px';
                              MonDiv.style.zIndex = 10;

                              MonDiv.appendChild(MonP);
                          }
                          if(arr.indexof('화') != -1){
                              TueDiv = document.createElement('div');
                              TueP = document.createElement('p');
                              
                              TueP.appendChild(res.result[i]);
                              TueDiv.style.position = absolute;
                              TueDiv.style.top = (110 + 60*(arr[1] - 1))+'px';
                              TueDiv.style.zIndex = 10;

                              TueDiv.appendChild(Tue);
                          }
                          if(arr.indexof('수') != -1){
                              WedDiv = document.createElement('div');
                              WedP = document.createElement('p');
                              
                              WedP.appendChild(res.result[i]);
                              WedDiv.style.position = absolute;
                              WedDiv.style.top = (110 + 60*(arr[1] - 1))+'px';
                              WedDiv.style.zIndex = 10;

                              WedDiv.appendChild(WedP);
                          }
                          if(arr.indexof('목') != -1){
                              ThuDiv = document.createElement('div');
                              ThuP = document.createElement('p');
                              
                              ThuP.appendChild(res.result[i]);
                              ThuDiv.style.position = absolute;
                              ThuDiv.style.top = (110 + 60*(arr[1] - 1))+'px';
                              ThuDiv.style.zIndex = 10;

                              ThuDiv.appendChild(ThuP);
                          }
                          if(arr.indexof('금') != -1){
                              FriDiv = document.createElement('div');
                              FriP = document.createElement('p');
                              
                              FriP.appendChild(res.result[i]);
                              FriDiv.style.position = absolute;
                              FriDiv.style.top = (110 + 60*(arr[1] - 1))+'px';
                              FriDiv.style.zIndex = 10;

                              FriDiv.appendChild(FriP);
                          }
                      }

                  }

              }
          })
          .catch(err => {
              console.log('Fetch Error', err);
          });
      }

// make.addEventListener('click', sem);
    sem();
    </script>
    <script>
      function btn(sample){ alert(sample); }
    </script>
    <!-- <script>
      var num = 1;
      var day = 1;

      $(function(){
        var target = $('#target');
        $.getJSON('subject.json', function(subjects){
          var add_data = '';
          $.each(subjects, function(i, subject){
            if(day % 5 == 1){
              add_data += '<tr>';
              add_data += '<th>';
              add_data += num;
              add_data += '</th>';
            }
            
            if(day < 6){
              add_data += '<td>';
              add_data += num;
              add_data += '<br>';
              add_data += subject.name;
              add_data += '<br>';
              add_data += subject.professor;
              add_data += '<br>';
              add_data += day;
              add_data += '</td>';
              // for(i=day; i<5;i++){
              //   add_data += '<td>';
              //     add_data += '</td>';
              //   }
              day = day + 1;

            }
            else{
              add_data += '<tr>';
                add_data += '<th>';
                add_data += "else";
                add_data += num;
                add_data += '</th>';
                add_data += '<td>';
                add_data += subject.name;
                add_data += '<br>';
                add_data += subject.professor;
                add_data += '</td>';
              num = num + 1;
              if(day % 5 == 0){
                add_data += '</tr>';
              }
            }

            target.append(add_data);
          });
        });
      });
    </script> -->
    
</body>

</html>
